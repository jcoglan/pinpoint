JS.State=new JS.Module({__getState__:function(a){return(typeof a==='object'&&a)||(typeof a==='string'&&((this.states||{})[a]||{}))||{}},setState:function(a){this.__state__=this.__getState__(a);JS.State.addMethods(this.__state__,this.klass)},inState:function(){var a=arguments.length;while(a--){if(this.__state__===this.__getState__(arguments[a]))return true}return false},extend:{stub:function(){return this},buildStubs:function(a,b,d){var c,e;for(c in d){b[c]={};for(e in d[c])a[e]=this.stub}},buildCollection:function(a,b){var d={},c={},e=a.lookup('states').pop()||{};this.buildStubs(d,c,b);this.buildStubs(d,c,e);var g,f,i,h;for(g in c){f=(e[g]||{}).klass;f=f?new JS.Class(f,b[g]):new JS.Class(b[g]);i={};for(h in d){if(!f.prototype[h])i[h]=d[h]}f.include(i);c[g]=new f}if(a.__res__)this.addMethods(d,a.__res__.klass);return c},addMethods:function(a,b){if(!b)return;var d={},c=b.prototype;for(var e in a){if(c[e])continue;c[e]=b.__mod__.__fns__[e]=this.wrapped(e)}},wrapped:function(b){return function(){var a=(this.__state__||{})[b];return a?a.apply(this,arguments):this}}}});JS.Module.include({define:(function(d){return function(a,b){if(a==='states'&&typeof b==='object')arguments[1]=JS.State.buildCollection(this,b);return d.apply(this,arguments)}})(JS.Module.prototype.define)});